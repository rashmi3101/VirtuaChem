/* js-toolbar v0.0.0 | https://github.com/mpecherstorfer/js-toolbar/blob/master/LICENSE */
(function(e){"use strict";var t,n="toolbar",o=50,i=1e3,s=false,u=true,r=true,d="slide",c="slide",f="swing",a="swing",h=500,p=500,l="toolbar",m="tb-menu",x="tb-item",b="rounded",y="dock-right",F="disabled",M="hidden",$="ui-effects-wrapper",v="ui-effects-explode",I={escape:27,left:37,up:38,right:39,down:40};function g(e){return Object.prototype.toString.call(e)==="[object Object]"}function w(e){t.each(Array.prototype.slice.call(arguments,1),function(t,n){e=e.replace(new RegExp("\\{"+t+"\\}","g"),n)});return e}function k(){t(e.document).on("keydown."+n,function(e){return e.keyCode!==I.up&&e.keyCode!==I.down&&e.keyCode!==I.left&&e.keyCode!==I.right})}function T(e,t){this.$root=e;this.opt={};this.menus=[];this.create().options(t||{}).observeWindow()}T.defaultOptions=function(){return{isRounded:s,isAboveMenus:u,isSkippable:r,showMenuFx:{effect:d,easing:f,duration:h},hideMenuFx:{effect:c,easing:a,duration:p}}};T.$nextItem=function(e,n){var o;if(n){o=n.index(e)+1;if(o>0){return t(n[o%n.length])}}return t()};T.$prevItem=function(e,n){var o;if(n){o=n.index(e);if(o>=0){o=o-1+n.length;return t(n[o%n.length])}}return t()};T.$menuItems=function(e){if(T.isMenuLeadItem(e)){return t("a."+x,e.parent())}else if(T.isMenuBodyItem(e)){return t("a."+x,e.parent().parent().parent())}};T.isFxAvailable=function(e){if(!e){return t.effects!==undefined&&t.effects.effect!==undefined}return t.effects.effect[e]!==undefined};T.isFxComboInversableAfterStop=function(e,t){return e==="slide"&&t==="slide"||e==="slide"&&t==="fade"||e==="fade"&&t==="slide"||e==="fade"&&t==="fade"};T.isVectoredFx=function(e){switch(e){case"blind":case"bounce":case"drop":case"shake":case"slide":return true}return false};T.isOrientedFx=function(e){return e==="clip"||e==="scale"};T.isFocusHijackingFx=function(e){switch(e){case"bounce":case"drop":case"explode":case"puff":case"shake":return true}return false};T.isItem=function(e){return e.hasClass(x)};T.isMenuLeadItem=function(e){return T.isItem(e)&&e.next().hasClass(m)};T.isMenuBodyItem=function(e){return T.isItem(e)&&e.parent().parent().hasClass(m)};T.isMenuItem=function(e){return T.isMenuLeadItem(e)||T.isMenuBodyItem(e)};T.isToolbarItem=function(e){return T.isItem(e)&&!T.isMenuBodyItem(e)};T.isDisabledItem=function(e){return T.isItem(e)&&e.hasClass(F)};T.focusItem=function(e,t){if(t.length>0){e.blur();t.focus()}};T.stopMenuFx=function(e,t){if(e.isShowFxInProgress||e.isHideFxInProgress){t=t||{};t.clearQueue=Boolean(t.clearQueue);t.jumpToEnd=Boolean(t.jumpToEnd);e.$body.stop(t.clearQueue,t.jumpToEnd);if(e.curFx==="blind"||e.curFx==="fold"){T.stopFxWrapper(e,t.clearQueue,t.jumpToEnd)}else if(e.curFx==="explode"){T.clearExplodeFxCompound()}e.isShowFxInProgress=false;e.isHideFxInProgress=false;e.curFx=undefined}return T};T.stopFxWrapper=function(e,t,n){e.$body.parent().stop(t,n);return T};T.removeFxWrapper=function(e){e.$body.parent().parent().append(t("> ul."+m,e.$body.parent()));e.$body.prev().remove();return T};T.clearExplodeFxCompound=function(){t("."+v).stop(true,false).remove();return T};T.fxNotAvailable=function(t){if(e.console){e.console.log('jQueryUI effect "'+t+'" is not available. '+"Has the corresponding module been imported? Applying fallback.")}return T};T.prototype.options=function(){function e(e,t){if(T.isOrientedFx(e.effect)){e.direction=e.direction||"horizontal"}else if(T.isVectoredFx(e.effect)){e.direction=e.direction||(t?"up":"down")}}return function(n){if(!n){return this.opt}this.opt=T.defaultOptions();t.extend(true,this.opt,n);e(this.opt.showMenuFx,this.opt.isAboveMenus);e(this.opt.hideMenuFx,this.opt.isAboveMenus);return this.applyOptions()}}();T.prototype.$items=function(){return t("a",this.$root)};T.prototype.$toolbarItems=function(e){e=e||{};var n="> li > a";if(e.excludeHidden){n+=":not(."+M+")"}if(e.excludeDisabled){n+=":not(."+F+")"}if(e.excludeMenuLeadItems){n+=":only-child"}return t(n,this.$root)};T.prototype.$menus=function(){return t("> li > a + ul",this.$root)};T.prototype.create=function(){this.$root.addClass(l);this.createItems();this.createMenus();return this};T.prototype.createItems=function(){var e=this.$items();e.addClass(x);e.each(t.proxy(function(e,n){this.observeItem(t(n))},this));this.$toolbarItems({excludeMenuLeadItems:true}).each(t.proxy(function(e,n){this.observeToolbarItem(t(n))},this));return this};T.prototype.createMenus=function(){var e=this.$menus();e.addClass(m);e.each(t.proxy(function(e,n){n=t(n);this.menus.push({$body:n,$lead:n.prev(),dockRight:n.hasClass(y)});this.observeMenu(this.menus[this.menus.length-1])},this));return this};T.prototype.isLeftEndMenu=function(e){return e.$body.parent().is(":first-child")};T.prototype.isRightEndMenu=function(e){return e.$body.parent().is(":last-child")};T.prototype.placeMenu=function(e){var t=e.dockRight?e.$lead.outerWidth()-e.$body.outerWidth():0;if(this.opt.isRounded){if(this.isLeftEndMenu(e)){t+=e.$lead.outerHeight()/2}else if(this.isRightEndMenu(e)){t-=e.$lead.outerHeight()/2}}e.$body.css("left",t+"px");e.$body.css("top",this.opt.isAboveMenus?e.$lead.outerHeight()+"px":-e.$body.outerHeight()+"px");return this};T.prototype.resetMenu=function(e){e.$body.removeAttr("style");if(e.$body.parent().hasClass($)){T.removeFxWrapper(e)}this.placeMenu(e);return this};T.prototype.showMenu=function(e,n){var o=t.Deferred(),s=function(){e.isShowFxInProgress=false;e.curFx=undefined;n.complete=undefined;o.resolve()};e.curFx=n.effect;e.isShowFxInProgress=true;t.each(this.menus,function(e,t){t.$body.css("z-index",i-1)});e.$body.css("z-index",i);if(T.isFxAvailable()){if(T.isFxAvailable(e.curFx)){n.complete=s;e.$body.show(n)}else{e.$body.css("display","block");if(e.curFx!=="none"){T.fxNotAvailable(e.curFx)}s()}}else{if(e.curFx==="slide"&&this.opt.isAboveMenus){e.$body.slideDown(n.duration,s)}else if(e.curFx==="fade"){e.$body.fadeIn(n.duration,s)}else{e.$body.show(n.duration,s)}}return o.promise()};T.prototype.hideMenu=function(e,n){var o=t.Deferred(),i=function(){e.isHideFxInProgress=false;e.curFx=undefined;n.complete=undefined;o.resolve()};e.curFx=n.effect;e.isHideFxInProgress=true;if(T.isFxAvailable()){if(T.isFxAvailable(e.curFx)){n.complete=i;e.$body.hide(n)}else{e.$body.css("display","none");if(e.curFx!=="none"){T.fxNotAvailable(e.curFx)}i()}}else{if(e.curFx==="slide"&&this.opt.isAboveMenus){e.$body.slideUp(n.duration,i)}else if(e.curFx==="fade"){e.$body.fadeOut(n.duration,i)}else{e.$body.hide(n.duration,i)}}return o.promise()};T.prototype.toggleMenu=function(e,t){if(e.$body.is(":hidden")){return this.showMenu(e,t.showMenuFx)}else{return this.hideMenu(e,t.hideMenuFx)}};T.prototype.placeMenus=function(){var e,n;t.each(this.menus,t.proxy(function(e,t){this.placeMenu(t)},this));return this};T.prototype.hideMenus=function(e){t.each(this.menus,t.proxy(function(t,n){if(e!==n&&!n.isHideFxInProgress&&n.$body.is(":visible")){if(n.isShowFxInProgress){T.stopMenuFx(n,{clearQueue:true});this.resetMenu(n)}else{this.hideMenu(n,this.opt.hideMenuFx)}}},this));return this};T.prototype.observeWindow=function(){t(e).on("keydown",t.proxy(function(e){if(e.keyCode===I.escape){this.hideMenus()}},this));t(e).on("resize",t.proxy(function(e){this.placeMenus()},this));return this};T.prototype.observeItem=function(e){e.on("keyup",t.proxy(function(t){switch(t.keyCode){case I.up:T.focusItem(e,T.$prevItem(e,T.$menuItems(e)));break;case I.down:T.focusItem(e,T.$nextItem(e,T.$menuItems(e)));break;case I.left:T.focusItem(e,T.$prevItem(e,this.$toolbarItems({excludeHidden:true,excludeDisabled:true})));break;case I.right:T.focusItem(e,T.$nextItem(e,this.$toolbarItems({excludeHidden:true,excludeDisabled:true})));break;case I.escape:e.blur();break}},this));return this};T.prototype.observeToolbarItem=function(e){e.on("mouseenter",t.proxy(function(e){if(T.isFocusHijackingFx(this.opt.showMenuFx.effect)){this.hideMenus()}},this));return this};T.prototype.observeMenu=function(n){this.observeMenuKeyboardEvents(n);this.observeMenuMouseEvents(n);n.$lead.on("focusin",function(){k()});n.$body.on("focusin",function(){k()});n.$lead.on("focusout",function(){t(e.document).off("keydown.toolbar")});n.$body.on("focusout",function(){t(e.document).off("keydown.toolbar")});return this};T.prototype.observeMenuKeyboardEvents=function(t){var n,i=this;t.$lead.on("focusin",function(o){e.clearTimeout(n);i.menuLeadItemFocusedIn(t)});t.$lead.on("focusout",function(s){n=e.setTimeout(function(){i.menuLeadItemFocusedOut(t)},o)});t.$body.on("focusin",function(t){e.clearTimeout(n)});t.$body.on("focusout",function(s){n=e.setTimeout(function(){i.menuFocusedOut(t)},o)});return this};T.prototype.observeMenuMouseEvents=function(n){n.$lead.on("mouseenter",t.proxy(function(t){if(n.hideMenuTimer){e.clearTimeout(n.hideMenuTimer);n.hideMenuTimer=undefined}else if(!(n.isShowFxInProgress&&T.isFocusHijackingFx(this.opt.showMenuFx.effect))){this.menuLeadItemFocusedIn(n)}},this));n.$lead.on("mouseleave",t.proxy(function(i){if(!(n.isShowFxInProgress&&T.isFocusHijackingFx(this.opt.showMenuFx.effect))){n.hideMenuTimer=e.setTimeout(t.proxy(function(){n.hideMenuTimer=undefined;this.menuLeadItemFocusedOut(n)},this),o)}},this));n.$body.on("mouseenter",function(t){e.clearTimeout(n.hideMenuTimer)});n.$body.on("mouseleave",t.proxy(function(i){n.hideMenuTimer=e.setTimeout(t.proxy(function(){n.hideMenuTimer=undefined;this.menuFocusedOut(n)},this),o)},this));return this};T.prototype.menuLeadItemFocusedIn=function(e){if(T.isFocusHijackingFx(this.opt.showMenuFx.effect)){this.hideMenus(e)}if(!T.isDisabledItem(e.$lead)){if(e.isHideFxInProgress){T.stopMenuFx(e,{clearQueue:true});this.resetMenu(e);if(this.opt.hideMenuFx.effect==="fade"){e.$body.css("opacity","0")}}this.showMenu(e,this.opt.showMenuFx)}return this};T.prototype.menuLeadItemFocusedOut=function(e){if(e.isShowFxInProgress){T.stopMenuFx(e,{clearQueue:true});if(T.isFxComboInversableAfterStop(this.opt.showMenuFx.effect,this.opt.hideMenuFx.effect)){this.hideMenu(e,this.opt.hideMenuFx).done(t.proxy(function(){this.resetMenu(e)},this))}else{this.resetMenu(e)}}else{this.hideMenu(e,this.opt.hideMenuFx)}return this};T.prototype.menuFocusedOut=function(e){this.hideMenu(e,this.opt.hideMenuFx);return this};T.prototype.applyOptions=function(){this.setRounded(this.opt.isRounded);this.setSkippable(this.opt.isSkippable);this.placeMenus();return this};T.prototype.setRounded=function(e){if(e){this.$root.addClass(b)}else{this.$root.removeClass(b)}return this};T.prototype.setSkippable=function(e){var t;if(this.$root.prev().is("div.tb-skip")){this.$root.prev().remove()}if(this.$root.next().is("span#toolbarEnd")){this.$root.next().remove()}if(e){t=this.opt.skipNavigationTarget;if(typeof t!=="string"){t="#toolbarEnd";this.$root.after('<span id="toolbarEnd"></span>')}if(t.charAt(0)!=="#"){t="#"+t}this.$root.before('<div class="tb-skip"><a href="'+t+'">Skip toolbar links</a></div>')}return this};function C(e){t=e;t.fn.toolbar=function(e){this.each(function(){t(this).data("toolbarModel",new T(t(this),e))});return this};t.fn.toolbarModel=function(){function e(e){var t=e.data("toolbarModel");return t?{options:function(e){if(!e){return t.options()}t.options(e)}}:undefined}return function(n){var o;if(n!==undefined){return e(t(t(this)[n]))}o=[];this.each(function(){o.push(e(t(this)))});return o}}()}(function(){if(typeof e.define!=="undefined"&&e.define.amd){e.define(["jquery"],function(e){C(e)})}else if(e.jQuery){C(e.jQuery)}})()})(this)